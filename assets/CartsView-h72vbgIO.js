import{m as C,h as k,_ as x,r as f,o as n,c as l,d as e,a,w as u,t as d,n as g,b as w,j as $,F as v,i as F,e as B,T as A}from"./index-FeLLQDu8.js";import{c as y}from"./cartStore-pSg0m_fv.js";const O="https://ec-course-api.hexschool.io/v2",V="2023-vue",I={data(){return{isAddingOrder:!1}},methods:{...C(y,["getCarts"]),checkoutOrder(s,i){this.isAddingOrder=!0;const{name:h,email:_,tel:p,address:r,message:t}=s,o={data:{user:{name:h,email:_,tel:p,address:r},message:t}};this.carts.length?this.axios.post(`${O}/api/${V}/order`,o).then(c=>{this.isAddingOrder=!1,alert(`${c.data.message}，訂單編號為「${c.data.orderId}」`),i.resetForm(),this.getCarts()}).catch(c=>{alert(c.response.data.message)}):(this.isAddingOrder=!1,alert("目前購物車沒有東西"),window.scrollTo({top:50,behavior:"smooth"}))}},computed:{...k(y,["carts"])}},j={class:"container py-5"},L=e("h2",{class:"mb-3 text-center"},"填寫訂單資料",-1),S={class:"row justify-content-center"},q={class:"col-10 col-md-8 col-lg-6"},T={class:"mb-3"},N={class:"d-flex justify-content-between"},D=e("label",{for:"email",class:"form-label"},"信箱",-1),E={class:"small text-danger"},M={class:"mb-3"},Q={class:"d-flex justify-content-between"},z=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),G={class:"small text-danger"},H={class:"mb-3"},J={class:"d-flex justify-content-between"},K=e("label",{for:"phone",class:"form-label"},"收件人電話",-1),P={class:"small text-danger"},R={class:"mb-3"},U={class:"d-flex justify-content-between"},W=e("label",{for:"address",class:"form-label"},"收件人地址",-1),X={class:"small text-danger"},Y={class:"mb-3"},Z=e("label",{for:"message",class:"form-label"},"留言",-1),ee={type:"submit",class:"btn btn-primary w-75 align-self-center"},te={key:0,class:"spinner-border spinner-border-sm",role:"status"};function se(s,i,h,_,p,r){const t=f("ErrorMessage"),o=f("VField"),c=f("VForm");return n(),l("div",j,[L,e("div",S,[e("div",q,[a(c,{onSubmit:r.checkoutOrder,class:"d-flex flex-column"},{default:u(({errors:b})=>[e("div",T,[e("span",N,[D,a(t,{name:"email",class:"invalid-feedback"},{default:u(({message:m})=>[e("span",E,d(m.replace("email","信箱")),1)]),_:1})]),a(o,{id:"email",name:"email",type:"email",class:g(["form-control",{"is-invalid":b.email}]),placeholder:"請輸入信箱",rules:"email|required"},null,8,["class"])]),e("div",M,[e("span",Q,[z,a(t,{name:"name",class:"invalid-feedback"},{default:u(({message:m})=>[e("span",G,d(m.replace("name","姓名")),1)]),_:1})]),a(o,{id:"name",name:"name",type:"text",class:g(["form-control",{"is-invalid":b.name}]),placeholder:"請輸入收件人姓名",rules:"required"},null,8,["class"])]),e("div",H,[e("span",J,[K,a(t,{name:"tel",class:"invalid-feedback"},{default:u(({message:m})=>[e("span",P,d(m.replace("tel","電話")),1)]),_:1})]),a(o,{id:"phone",name:"tel",type:"tel",class:g(["form-control",{"is-invalid":b.tel}]),placeholder:"請輸入 09 開頭的手機號碼",rules:{required:!0,regex:/^09\d{8}$/}},null,8,["class"])]),e("div",R,[e("span",U,[W,a(t,{name:"address",class:"invalid-feedback"},{default:u(({message:m})=>[e("span",X,d(m.replace("address","地址")),1)]),_:1})]),a(o,{id:"address",name:"address",type:"text",class:g(["form-control",{"is-invalid":b.address}]),placeholder:"請輸入收件人地址",rules:"required"},null,8,["class"])]),e("div",Y,[Z,a(o,{id:"message",name:"message",as:"textarea",class:"form-control",style:{height:"96px"},placeholder:"請輸入留言"})]),e("button",ee,[w(" 送出訂單 "),p.isAddingOrder?(n(),l("span",te)):$("",!0)])]),_:1},8,["onSubmit"])])])])}const ne=x(I,[["render",se]]),oe={data(){return{cartsInput:[],loadingBtn:""}},methods:{...C(y,["getCarts","delFromCart","delAllCarts","editCart"]),checkQty(s,i,h){const _=Number.parseInt(this.$refs.cartInput[s].value,10);_>=1?this.editCart(i,h,_):(alert("修改數量必須大於 1"),this.$refs.cartInput[s].value=this.carts[s].qty)},teleportLoading(s){this.loadingBtn=`#${s}`}},mounted(){this.getCarts()},computed:{...k(y,["carts","finalTotal","inputIsAble","isDelingFromCart"]),isOnSale(){return this.carts.map(s=>s.product.origin_price>s.product.price)}}},ae={class:"bg-light"},le={class:"container text-center py-4"},de=e("h2",null,"我的購物車",-1),re={class:"text-end mb-2"},ie={key:0,class:"my-5"},ce={key:1,class:"table table-hover align-middle"},_e=e("thead",null,[e("tr",null,[e("th",{scope:"col",width:"60"}),e("th",{scope:"col"},"品名"),e("th",{scope:"col"},"數量"),e("th",{scope:"col",width:"",class:"text-end"},"單價"),e("th",{scope:"col",width:"100",class:"text-end"},"小計")])],-1),pe={scope:"row"},me=["onClick","disabled","id"],he={key:0,class:"bi bi-trash3-fill"},ue={class:"d-flex justify-content-center"},fe={class:"input-group",style:{"max-width":"120px"}},be=["onChange","value","disabled"],ge={class:"input-group-text"},$e={class:"text-end"},ye={class:"mb-0"},ve={key:0,class:"text-danger fw-bold"},xe=e("span",{class:"d-none d-md-inline-block badge rounded-pill text-bg-warning fw-normal"},"特價中",-1),Ce={key:1},ke={class:"text-end"},we={class:"text-end"},Fe=e("td",{colspan:"4",class:"py-3"},"總計",-1),Be=e("span",{class:"spinner-border spinner-border-sm",role:"status"},null,-1);function Ae(s,i,h,_,p,r){return n(),l(v,null,[e("div",ae,[e("div",le,[de,e("div",re,[s.carts.length?(n(),l("button",{key:0,onClick:i[0]||(i[0]=t=>(s.delAllCarts(),r.teleportLoading("delAllBtn"))),type:"button",class:"btn btn-outline-danger btn-sm text-end",id:"delAllBtn"}," 清空購物車 ")):$("",!0)]),s.carts.length?(n(),l("table",ce,[_e,e("tbody",null,[(n(!0),l(v,null,F(s.carts,(t,o)=>(n(),l("tr",{key:t.id},[e("th",pe,[e("button",{onClick:c=>(s.delFromCart(t.id),r.teleportLoading(`delBtn${t.id}`)),type:"button",class:"btn btn-outline-secondary",disabled:s.isDelingFromCart,id:`delBtn${t.id}`},[p.loadingBtn!==`#delBtn${t.id}`?(n(),l("i",he)):$("",!0)],8,me)]),e("td",null,d(t.product.title),1),e("td",null,[e("div",ue,[e("div",fe,[e("input",{onChange:c=>r.checkQty(o,t.id,t.product_id),type:"number",min:"1",class:"form-control",value:t.qty,ref_for:!0,ref:"cartInput",disabled:s.inputIsAble},null,40,be),e("span",ge,d(t.product.unit),1)])])]),e("td",$e,[e("p",ye,[r.isOnSale[o]?(n(),l("span",ve,[xe,w(" "+d(t.product.price),1)])):(n(),l("span",Ce,d(t.product.origin_price),1))])]),e("td",ke,d(t.total),1)]))),128))]),e("tfoot",we,[e("tr",null,[Fe,e("td",null,d(s.finalTotal),1)])])])):(n(),l("p",ie,"目前購物車沒有商品喔！"))])]),s.isDelingFromCart?(n(),B(A,{key:0,to:p.loadingBtn},[Be],8,["to"])):$("",!0)],64)}const Oe=x(oe,[["render",Ae]]),Ve={components:{OrderForm:ne,CartsList:Oe}};function Ie(s,i,h,_,p,r){const t=f("CartsList"),o=f("OrderForm");return n(),l(v,null,[a(t),a(o)],64)}const Se=x(Ve,[["render",Ie]]);export{Se as default};
