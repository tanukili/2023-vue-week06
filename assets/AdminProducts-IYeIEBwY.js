import{_ as v,o as r,c,d as t,n as b,l as T,F as f,i as U,t as h,M,b as k,k as d,v as m,p as g,j as w,q as C,s as V,r as y,a as x}from"./index-FeLLQDu8.js";const $={props:["pagination","getProducts"]},I={"aria-label":"Page navigation"},D={class:"pagination justify-content-center"},S=t("span",{"aria-hidden":"true"},"«",-1),j=[S],A=["onClick"],N=t("span",{"aria-hidden":"true"},"»",-1),E=[N];function z(a,e,l,p,o,i){return r(),c("nav",I,[t("ul",D,[t("li",{class:b(["page-item",{disabled:!l.pagination.has_pre}])},[t("a",{class:"page-link",href:"#","aria-label":"Previous",onClick:e[0]||(e[0]=T(s=>l.getProducts(l.pagination.current_page-1),["prevent"]))},j)],2),(r(!0),c(f,null,U(l.pagination.total_pages,s=>(r(),c("li",{class:b(["page-item",{active:l.pagination.current_page===s}]),key:s},[t("a",{class:"page-link",href:"#",onClick:T(u=>l.getProducts(s),["prevent"])},h(s),9,A)],2))),128)),t("li",{class:b(["page-item",{disabled:!l.pagination.has_next}])},[t("a",{class:"page-link",href:"#","aria-label":"Next",onClick:e[1]||(e[1]=T(s=>l.getProducts(l.pagination.current_page+1),["prevent"]))},E)],2)])])}const B=v($,[["render",z]]),F={props:["title","id","getProducts"],data(){return{url:"",path:"",delModal:null}},methods:{delProduct(a){this.axios.delete(`${this.url}/api/${this.path}/admin/product/${a}`).then(e=>{alert(e.data.message),this.delModal.hide(),this.getProducts()}).catch(e=>{alert(e.response.data.message)})}},mounted(){this.url="https://ec-course-api.hexschool.io/v2",this.path="2023-vue",this.delModal=new M(this.$refs.delModal)}},L={class:"modal fade",id:"delModal",ref:"delModal",tabindex:"-1"},O={class:"modal-dialog"},q={class:"modal-content"},G=t("div",{class:"modal-header bg-danger"},[t("h5",{class:"modal-title text-white"},"刪除產品"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),H={class:"modal-body"},J={class:"mb-0"},K={class:"text-danger fw-bold"},Q={class:"modal-footer"},R=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function W(a,e,l,p,o,i){return r(),c("div",L,[t("div",O,[t("div",q,[G,t("div",H,[t("p",J,[k(" 是否刪除 "),t("span",K,h(l.title),1),k(" 商品(刪除後將無法恢復)。 ")])]),t("div",Q,[R,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=s=>i.delProduct(l.id))}," 確認刪除 ")])])])],512)}const X=v(F,[["render",W]]),Y={props:["temp","getProducts"],data(){return{url:"",path:"",formData:{},modalTemp:{imagesUrl:[]},productModal:null}},methods:{addImage(){this.modalTemp.imagesUrl.push("")},delImage(){this.modalTemp.imagesUrl.pop()},uploadImage(a,e){const l=e.target.files[0],p=new FormData;p.append("file-to-upload",l),this.axios.post(`${this.url}/api/${this.path}/admin/upload`,p).then(o=>{a!==null?this.modalTemp.imagesUrl[a]=o.data.imageUrl:this.modalTemp.imageUrl=o.data.imageUrl}).catch(o=>{alert(o.response.data.message)})},editProduct(a=""){let e="post",l=`${this.url}/api/${this.path}/admin/product`;a&&(e="put",l=`${l}/${a}`);const p={data:{...this.temp}};this.axios[e](`${l}`,p).then(o=>{alert(o.data.message),this.productModal.hide(),this.getProducts()}).catch(o=>{alert(o.response.data.message)})}},mounted(){this.url="https://ec-course-api.hexschool.io/v2",this.path="2023-vue",this.modalTemp=this.temp,this.productModal=new M(this.$refs.productModal),this.$refs.productModal.addEventListener("hidden.bs.modal",()=>{this.modalTemp=this.$options.data().modalTemp,this.$refs.fileValue.value=null,this.$emit("temp",this.modalTemp)}),this.$refs.productModal.addEventListener("show.bs.modal",()=>{this.modalTemp=this.temp})}},Z={class:"modal fade",id:"productModal",ref:"productModal",tabindex:"-1"},tt={class:"modal-dialog modal-xl"},et={class:"modal-content"},ot={class:"modal-header bg-dark"},st={class:"modal-title fs-5 text-white"},lt={class:"modal-body"},at={class:"container-fluid"},it={class:"row"},dt={class:"col-sm-4"},nt={class:"mb-3"},rt=t("label",{for:"mainImg",class:"form-label"},"主要圖片",-1),ct={class:"input-group my-2"},mt=["src"],pt=t("h4",{class:"fs-3 mb-3"},"多圖新增",-1),ut=t("label",{for:"otherImg01",class:"form-label"},"圖片網址",-1),ht=["onUpdate:modelValue"],_t={class:"input-group my-2"},gt=["onChange"],bt=["src","alt"],ft={class:"col-sm-8"},vt={class:"row"},Tt={class:"col-md mb-3"},yt=t("label",{for:"title",class:"form-label"},"標題",-1),xt={class:"col-md mb-3"},Ut=t("label",{for:"recommendation",class:"form-label"},"熱門度",-1),kt=t("option",{value:"0",disabled:"",hidden:""},"請選擇熱門度",-1),Mt=t("option",{value:"1"},"偏低",-1),Pt=t("option",{value:"2"},"普通",-1),wt=t("option",{value:"3"},"銷售前十",-1),Ct=[kt,Mt,Pt,wt],Vt={class:"row"},$t={class:"col-md mb-3"},It=t("label",{for:"category",class:"form-label"},"分類",-1),Dt={class:"col-md mb-3"},St=t("label",{for:"unit",class:"form-label"},"單位",-1),jt={class:"row"},At={class:"col-md mb-3"},Nt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Et={class:"col-md mb-3"},zt=t("label",{for:"price",class:"form-label"},"售價",-1),Bt=t("hr",null,null,-1),Ft={class:"mb-3"},Lt=t("label",{for:"description",class:"form-label"},"產品描述",-1),Ot={class:"mb-3"},qt=t("label",{for:"content",class:"form-label"},"說明內容",-1),Gt={class:"form-check"},Ht=t("label",{for:"is_enabled",class:"form-check-label"},"是否啟用",-1),Jt={class:"modal-footer"},Kt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Qt(a,e,l,p,o,i){return r(),c("div",Z,[t("div",tt,[t("div",et,[t("div",ot,[t("h3",st,h(o.modalTemp.id?"編輯產品":"新增產品"),1)]),t("div",lt,[t("div",at,[t("form",it,[t("div",dt,[t("div",nt,[rt,d(t("input",{type:"text",id:"mainImg",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=s=>o.modalTemp.imageUrl=s)},null,512),[[m,o.modalTemp.imageUrl,void 0,{lazy:!0}]]),t("div",ct,[t("input",{type:"file",ref:"fileValue",class:"form-control",onChange:e[1]||(e[1]=s=>i.uploadImage(null,s))},null,544)]),d(t("img",{src:o.modalTemp.imageUrl,alt:"主要圖片",class:"img-fluid mt-2"},null,8,mt),[[g,o.modalTemp.imageUrl]])]),pt,o.modalTemp.imagesUrl?(r(!0),c(f,{key:0},U(o.modalTemp.imagesUrl,(s,u)=>(r(),c("div",{class:"mb-2",key:u},[ut,d(t("input",{type:"text",id:"otherImg01",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":_=>o.modalTemp.imagesUrl[u]=_},null,8,ht),[[m,o.modalTemp.imagesUrl[u]]]),t("div",_t,[t("input",{type:"file",class:"form-control",onChange:_=>i.uploadImage(u,_)},null,40,gt)]),d(t("img",{src:s,alt:"新增圖片"+(u+1),class:"img-fluid mt-2"},null,8,bt),[[g,s]])]))),128)):w("",!0),d(t("button",{type:"button",class:"btn btn-outline-primary btn-sm w-100",onClick:e[2]||(e[2]=(...s)=>i.addImage&&i.addImage(...s))}," 新增圖片 ",512),[[g,!o.modalTemp.imagesUrl.length||o.modalTemp.imagesUrl.at(-1)]]),d(t("button",{type:"button",class:"btn btn-outline-danger btn-sm w-100 mt-4",onClick:e[3]||(e[3]=(...s)=>i.delImage&&i.delImage(...s))}," 刪除圖片 ",512),[[g,o.modalTemp.imagesUrl.length&&!o.modalTemp.imagesUrl.at(-1)]])]),t("div",ft,[t("div",vt,[t("div",Tt,[yt,d(t("input",{type:"text",id:"title",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[4]||(e[4]=s=>o.modalTemp.title=s)},null,512),[[m,o.modalTemp.title]])]),t("div",xt,[Ut,d(t("select",{class:"form-select form-select-lg mb-3",id:"recommendation","onUpdate:modelValue":e[5]||(e[5]=s=>o.modalTemp.recommendation=s)},Ct,512),[[C,o.modalTemp.recommendation]])])]),t("div",Vt,[t("div",$t,[It,d(t("input",{type:"text",id:"category",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[6]||(e[6]=s=>o.modalTemp.category=s)},null,512),[[m,o.modalTemp.category]])]),t("div",Dt,[St,d(t("input",{type:"text",id:"unit",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[7]||(e[7]=s=>o.modalTemp.unit=s)},null,512),[[m,o.modalTemp.unit]])])]),t("div",jt,[t("div",At,[Nt,d(t("input",{type:"number",id:"origin_price",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[8]||(e[8]=s=>o.modalTemp.origin_price=s),min:"0"},null,512),[[m,o.modalTemp.origin_price,void 0,{number:!0}]])]),t("div",Et,[zt,d(t("input",{type:"number",id:"price",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[9]||(e[9]=s=>o.modalTemp.price=s),min:"0"},null,512),[[m,o.modalTemp.price,void 0,{number:!0}]])])]),Bt,t("div",Ft,[Lt,d(t("textarea",{id:"description",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[10]||(e[10]=s=>o.modalTemp.description=s)},null,512),[[m,o.modalTemp.description]])]),t("div",Ot,[qt,d(t("textarea",{id:"content",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[11]||(e[11]=s=>o.modalTemp.content=s)},null,512),[[m,o.modalTemp.content]])]),t("div",Gt,[d(t("input",{type:"checkbox",id:"is_enabled",class:"form-check-input","onUpdate:modelValue":e[12]||(e[12]=s=>o.modalTemp.is_enabled=s),"true-value":"1","false-value":"0"},null,512),[[V,o.modalTemp.is_enabled]]),Ht])])])])]),t("div",Jt,[Kt,t("button",{type:"button",class:"btn btn-primary",onClick:e[13]||(e[13]=s=>i.editProduct(o.modalTemp.id))}," 確認 ")])])])],512)}const Rt=v(Y,[["render",Qt]]),Wt={components:{AdminPagination:B,DelModal:X,productModal:Rt},data(){return{url:"",path:"",temp:{category:"",content:"",description:"",imageUrl:"",imagesUrl:[],is_enabled:0,origin_price:0,price:0,title:"",unit:"",id:"",recommendation:0},products:[],pagination:{}}},methods:{getProducts(a=1){this.axios.get(`${this.url}/api/${this.path}/admin/products?page=${a}`).then(e=>{this.pagination=e.data.pagination,this.products=Object.values(e.data.products)}).catch(e=>{alert(e.response.data.message)})},getSpecificProduct(a){const e=this.products.find(l=>l.id===a);Object.keys(e).forEach(l=>{this.temp[l]=e[l]})},resetProductModal(a){this.temp=a}},mounted(){this.url="https://ec-course-api.hexschool.io/v2",this.path="2023-vue";const a=document.cookie.replace(/(?:(?:^|.*;\s*)adminToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.axios.defaults.headers.common.Authorization=a,this.getProducts()}},Xt={class:"container-md"},Yt=t("div",{class:"text-end mt-4"},[t("button",{type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#productModal"}," 建立新的產品 ")],-1),Zt={class:"table table-borderless mt-4 mb-3"},te=t("thead",null,[t("tr",{class:"border-bottom"},[t("th",{width:"100"},"分類"),t("th",null,"產品名稱"),t("th",{width:"100"},"原價"),t("th",{width:"100"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"140"},"編輯")])],-1),ee={scope:"row"},oe={class:"fs-6 fw-normal lh-base"},se={class:"text-end"},le={class:"text-end"},ae={class:"btn-group",role:"group"},ie=["onClick"],de=["onClick"];function ne(a,e,l,p,o,i){const s=y("AdminPagination"),u=y("DelModal"),_=y("product-Modal");return r(),c(f,null,[t("div",Xt,[Yt,t("table",Zt,[te,t("tbody",null,[(r(!0),c(f,null,U(o.products,n=>(r(),c("tr",{class:"border-bottom",key:n.id},[t("th",ee,[t("h3",oe,h(n.category),1)]),t("td",null,h(n.title),1),t("td",se,h(n.origin_price),1),t("td",le,h(n.price),1),t("td",null,[t("span",{class:b({"text-success":n.is_enabled,"text-danger":!(n.is_enabled*1)})},h(n.is_enabled*1?"啟用":"未啟用"),3)]),t("td",ae,[t("button",{class:"btn btn-outline-primary",type:"button","data-bs-toggle":"modal","data-bs-target":"#productModal",onClick:P=>i.getSpecificProduct(n.id)}," 編輯 ",8,ie),t("button",{class:"btn btn-outline-danger",type:"button","data-bs-toggle":"modal","data-bs-target":"#delModal",onClick:P=>i.getSpecificProduct(n.id)}," 刪除 ",8,de)])]))),128))])]),x(s,{pagination:o.pagination,"get-products":i.getProducts},null,8,["pagination","get-products"])]),x(u,{title:o.temp.title,id:o.temp.id,"get-products":i.getProducts},null,8,["title","id","get-products"]),x(_,{temp:o.temp,"get-products":i.getProducts,onTemp:i.resetProductModal},null,8,["temp","get-products","onTemp"])],64)}const ce=v(Wt,[["render",ne]]);export{ce as default};
